# 📄 PRD 產品需求文件 (V1.4)

## 1. 專案概述
* **專案名稱**：個人化筆記與社交分享平台 (Kai Studio)
* **專案目標**：從個人筆記出發，逐步擴展至社交、即時通訊、生活紀錄（健身、理財）的綜合性平台。
* **技術核心**：前後端分離 (**FastAPI + React**)，全異步架構 (Async/Await)，強調「設計先行」與「安全管理」。

---

## 2. 角色權限與權限定義

### 2.1 超級管理員 (Superadmin)
* **角色識別**：`user_permissions.is_superuser = True`。
* **權限範圍**：
    * 內容審核：針對 `sync_status = 1` (待同步) 的文章進行審核。
    * 使用者管理：透過權限表停權違規者 (`is_banned`) 或手動調整特定功能權限。
    * 系統監控：管理後台存取權限 (`/admin`)。

### 2.2 一般註冊使用者 (Verified User)
* **帳號狀態**：`is_active = True` (**必須**完成信箱驗證，否則無法登入)。
* **個人空間**：管理私有 (0)、個人頁公開 (1)、或全站公開 (3) 的文章。
* **安全性**：支援多設備登入管理，可遠端登出特定設備。

### 2.3 訪客 (Visitor) / 未激活使用者
* **訪客權限**：僅能存取全站公開筆記與他人公開之 Profile。
* **未激活者**：註冊後未驗證信箱者，將無法進入登入後的私有頁面，系統引導至驗證提醒頁。

---

## 3. UI/UX 導覽與流程架構

### 3.1 響應式導覽列 (Navbar)
* **狀態 A (未登入)**：首頁 | 關於我 | 公開筆記 | 登入 | 註冊
* **狀態 B (已登入)**：首頁 | 我的空間 | 筆記管理 | 使用者頭像(選單)
    * **選單內含**：個人設定、設備管理、管理後台(限 Admin)、登出。
* **視覺特性**：支援電腦版浮動玻璃質感、手機版側邊漢堡選單動畫、**Light/Dark 雙色主題切換**。

### 3.2 路由守衛與跳轉邏輯 (Route Guard)
* **PublicRoute**：已登入者訪問登入/註冊/驗證頁面時，自動重定向至 `/dashboard`。
* **PrivateRoute**：未登入者訪問私有頁面時，強制重定向至 `/login`。
* **AdminRoute**：非管理員嘗試進入 `/admin` 時，強制彈回 `/dashboard`。

---

## 4. 核心功能細節

### 4.1 身份驗證流 (Auth Flow)
* **註冊**：建立帳號並發送驗證郵件。
* **驗證**：使用者點擊郵件連結，前端 `VerifyEmail` 組件呼叫 API 激活帳號，成功後引導至登入。
* **登入**：採用 **JWT 雙 Token (Access + Refresh)** 機制。
    * **Access Token**：存於記憶體/Store。
    * **Refresh Token**：存於 Redis，用於無感刷新。
* **同步**：透過 `window.storage` 事件監聽，達成多分頁登入狀態同步更新。

### 4.2 API 設計規範 (Restful Standard)
* **命名原則**：後端內部檔案與實體採單數 (note.py)，外部網址進入點採複數 (`/notes`, `/users`)。

### 4.3 設備管理 (Device Management)
* **識別**：自動解析 `User-Agent` 識別操作系統與瀏覽器。
* **控制**：登入時紀錄設備 ID，登出時從 Redis 移除對應之 Refresh Token。

---

## 5. 技術指標需求
* **效能**：後端採用全異步 (AsyncIO)，前端使用 **Zustand** 進行輕量化狀態管理。
* **安全性**：
    * 密碼 Bcrypt 雜湊。
    * 防止 XSS 與 CSRF。
    * **跨分頁同步防護**：確保登出操作即時反應於所有分頁。
* **響應式**：使用 Tailwind CSS 確保手機與桌機一致體驗。